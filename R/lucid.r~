# lucid.r
# Time-stamp: <13 Dec 2014 20:24:19 c:/x/rpack/lucid/R/lucid.r>

lucid <- function(x, dig=3, ...) UseMethod("lucid")


lucid.default <- function(x, dig=3, na.replace=NULL, ...) {
  # By default, do nothing
  return(x)
}


lucid.numeric <- function(x, dig=3, na.replace=NULL, ...) {
  # This is the workhorse that does the formatting, but NO PRINTING
  # Use 4 significant digits, drop trailing zero, align decimals
  if(class(x)=="numeric" | class(x)=="integer") {
    xx <- format(format(signif(zapsmall(x), dig), scientific=FALSE,
                        drop0trailing=TRUE))

    # Change "NA" to something else
    if(!is.null(na.replace)) xx <- gsub("NA", na.replace, xx)

  } else xx <- x
  return(xx)
}

# These are the functions that actually do  the printing
# Also, invisibly return the result
lucid.data.frame <- function(x, dig=3, na.replace=NULL, quote=FALSE, ...){
  x[] <- lapply(x, lucid, dig, na.replace)
  print(x, quote=quote)
  invisible(x)
}


lucid.matrix <- function(x, dig=3, na.replace=NULL, quote=FALSE, ...){
  x[] <- apply(x, 2, lucid, dig, na.replace)
  print(x, quote=quote)
  invisible(x)
}


lucid.list <- function(x, dig=3, na.replace=NULL, quote=FALSE, ...){
  #x[] <- apply(x, 2, lucid, dig)
  for(ii in 1:length(x)){
    cat(names(x)[ii], ":\n")
    lucid(x[[ii]], dig=dig, na.replace=na.replace)
  }
}

if(0){
mtc <- mtcars[1:10,]
mtc[3,] <- NA
lucid(mtc, na="")

kk=c(1.23, NA, 123)
}
